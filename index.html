<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Mike Eagle</title>
		<style>
			body { 
				font-family: 'TerminalGrotesqueRegular'; 
			    font-weight: normal; 
			    font-style: normal; 
				margin: 0; 
			}
			canvas { 
				width: 100%; 
				height: 100%; 
			}
			nav {
				position: absolute;
				top: 0;
				left: 50%;
				width: 150px;
				margin-left: -75px;
				text-align: center;
				z-index: 100;
				display:block;
				color: #000;
				background-color: #fff;
				height: 100vh;
				max-height: 1.5rem;
				overflow: hidden;
				-webkit-transition: 320ms;
				-moz-transition: 320ms;
				-ms-transition: 320ms;
				-o-transition: 320ms;
				transition: 320ms;
				
			}
			nav.open {
				max-height: 1200px;
				-webkit-transition: 320ms;
				-moz-transition: 320ms;
				-ms-transition: 320ms;
				-o-transition: 320ms;
				transition: 320ms;
				
			}
			.menu {
				list-style-type: none;
				padding-left: 0;
				margin-top: 10rem;
			}
			.menu li {
				width: 100%;
				line-height: 2.25em;
			}
			.menu li:hover {
				background-color: #000;
			}
			.menu li a {
				color: #000;
				font-size: 2em;
				text-decoration: none;
				text-transform: uppercase;
				font-weight: 300;
				letter-spacing: 2px;
			}
			.menu li:hover a {
				color: #fff;
			}
			button {
				text-transform: uppercase;
				width: 100%;
				line-height: 1.25rem;
				font-size: 0.8rem;
				background-color: transparent;
				border: 0;
				cursor: pointer;
				font-weight: 600;
			}
			button:focus {
				outline: none;
			}
		</style>
				<link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/terminal-grotesque" type="text/css"/>
	</head>
	<body>
		<nav>
			<button>Open Mike Eagle</button>

			<ul class="menu">
				<li><a href="listen.html">
					Listen
				</a></li>
				<li><a href="watch.html">
					Watch
				</a></li>
				<li><a href="shop.html">
					Shop
				</a></li>
				<li><a href="blog.html">
					Blog
				</a></li>
			</ul>
		</nav>
		<script
		  src="https://code.jquery.com/jquery-3.2.0.min.js"
		  integrity="sha256-JAW99MJVpJBGcbzEuXk4Az05s/XyDdBomFqNlM3ic+I="
		  crossorigin="anonymous"></script>
		<script src="js/three.js"></script>
		<script src="js/Tween.js"></script>
		<script src="js/MTLLoader.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script src="js/ColladaLoader.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/dat.gui.min.js"></script>
		<script>
			$('button').on('click', function() {
				console.log('open');
				$('nav').toggleClass('open');
			});
		</script>
		<script>
			(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='http://rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()

			var camera, scene, renderer;
			var mtlLoader, objects, ambientLight, controls;
			var floor, floorMat, floorGeo;
			var onProgress, onError;
			var update, render, GameLoop;
			var raycaster, mouse, INTERSECTED;
			var setMaterial;

			var colorHash = {};
			
			var gui;
			
			
			
			scene = new THREE.Scene();
			scene.fog = new THREE.FogExp2( 0x333333, 0.0009);

			camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight, 0.1, 20000);

			renderer = new THREE.WebGLRenderer({
				antialias: true
			});
			renderer.setClearColor(0xFFFFFF);
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.shadowMap.enabled = true;
			renderer.shadowMap.type = THREE.PCFSoftShadowMap;
			
			
			floorMat = new THREE.MeshBasicMaterial({
				color: 0xFFFFFF,
				side: THREE.DoubleSide
			});
			floorGeo = new THREE.PlaneGeometry(2000,2000,10,10);
			floor = new THREE.Mesh(floorGeo, floorMat);
			floor.position.y = -0.5;
			floor.rotation.x = Math.PI / 2;
			//scene.add(floor);

			///ambientLight = new THREE.AmbientLight( 0xFFFFFF, 0.75 );
			
			
		
			
		var spotLight = new THREE.SpotLight( 0xffffff );

spotLight.position.y = 80;
spotLight.penumbra = 0.2;

	spotLight.castShadow = true;

				spotLight.shadow.mapSize.width = 2048;  // default
				spotLight.shadow.mapSize.height = 2048; // default
				spotLight.shadow.camera.near = 0.5;       // default
				spotLight.shadow.camera.far = 300;      // default
			
				
				
				var helper = new THREE.CameraHelper( spotLight.shadow.camera );
scene.add( helper );

/*
spotLight.shadow.mapSize.width = 1024;
spotLight.shadow.mapSize.height = 1024;
*/

/*
spotLight.shadow.camera.near = 500;
spotLight.shadow.camera.far = 4000;
spotLight.shadow.camera.fov = 30;
*/

scene.add( spotLight );	
			
		
			
			//scene.add( ambientLight );

			document.body.appendChild(renderer.domElement);

			window.addEventListener('resize', function() {
				var width = window.innerWidth;
				var height = window.innerHeight;
				renderer.setSize(width, height);
				camera.aspect = width / height;
				camera.updateProjectionMatrix();
			})

			camera.position.z = 120;
			camera.position.x = 0;
			camera.position.y = 20;
			camera.lookAt(new THREE.Vector3())
			controls = new THREE.OrbitControls(camera,renderer.domElement);
			
			/*
new TWEEN.Tween( camera.position ).to( {
						x: 0,
						y: 20,
						z: 120}, 4000 )
					.easing( TWEEN.Easing.Quadratic.Out).start();
*/

			
			/*
new TWEEN.Tween( controls.target ).to( {
				x: 0,
				y: 100,
				z: 0}, 4000 )
				.easing( TWEEN.Easing.Quadratic.Out).start();
*/

			
			

			raycaster = new THREE.Raycaster();
			mouse = new THREE.Vector2();

			function onMouseMove( event ) {

				// calculate mouse position in normalized device coordinates
				// (-1 to +1) for both components

				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
			}
			
			function setMaterial(object, hex) {
				var t = object.material.type.toString();

				if (hex == null) {
				
				colors = colorHash[INTERSECTED.uuid]
				if (t.localeCompare("MultiMaterial") == 0 ) {
						for (i = 0; i < object.material.materials.length; i++) {
							object.material.materials[i].color.setHex(colors[i]);
						}
					}
					else{
						object.material.color.setHex(colors[0]);
					}
				}
				else if (t.localeCompare("MultiMaterial") == 0 ) {
					var materials = object.material.materials
					colorHash[object.uuid] = materials.map(function(obj) { 
					
						return obj.color.getHex()
					});
					object.material.materials = materials.map(function(obj) { 
						var newObj = obj
						newObj.color.setHex(hex)
						return newObj
					});

				}
				else {
					colorHash[object.uuid] = [object.material.color.getHex()];
					object.material.color.setHex(hex)
				}
			}
			
			
			
			var loader = new THREE.ColladaLoader();

loader.load(
	// resource URL
	'models/LOWPOLYLAND.dae',
	// Function when resource is loaded
	function ( collada ) {
		dae = collada.scene
		dae.traverse( function(child) {
		
		console.log(child.children)
		child.castShadow = true;
		child.receiveShadow = true;
		console.log(child.name)
		if( child.material ) {
      	  child.material.side = THREE.DoubleSide;
		}
		
		daemesh = dae.children[1];
daemesh.castShadow = true;
daemesh.receiveShadow = true;

			
		});
		scene.add( dae );
	},
	// Function called when download progresses
	function ( xhr ) {
		console.log( (xhr.loaded / xhr.total * 100) + '% loaded' );
	}
);



			update = function() {

			}

			render = function() {
			
			
				TWEEN.update();
				// update the picking ray with the camera and mouse position
				raycaster.setFromCamera( mouse, camera );

				// calculate objects intersecting the picking ray
				var intersects = raycaster.intersectObjects( scene.children, true );
				
				
				if ( intersects.length > 0 ) {
				
				
					if ( INTERSECTED != intersects[ 0 ].object ) {
						//if (INTERSECTED) setMaterial( INTERSECTED, INTERSECTED.currentHex )
						INTERSECTED = intersects[ 0 ].object;
 						if (INTERSECTED.name.indexOf('s_') == 0) {
						
						var pos = INTERSECTED.position
						new TWEEN.Tween( INTERSECTED.position ).to( {
						x: pos.x,
						y: pos.y + 10,
						z: pos.z}, 400 )
					.yoyo( true )
					.repeat( 1 )
					.easing( TWEEN.Easing.Quadratic.Out)
					.start();
						
						//setMaterial( INTERSECTED, 0xff0000 )
						}
					}
				} else {
				//	if (INTERSECTED) setMaterial( INTERSECTED, null )
					INTERSECTED = null;
				}

				renderer.render(scene, camera);
			}

			GameLoop = function() {
				requestAnimationFrame( GameLoop );
				update();
				render();
			}

			window.addEventListener( 'mousemove', onMouseMove, false );
			GameLoop();
			
			
			function buildGui() {

				gui = new dat.GUI();

				var params = {
					light_x : 0,
					light_y : 100,
					light_z : 0,
					'light color': spotLight.color.getHex(),
					intensity: spotLight.intensity,
					distance: spotLight.distance,
					angle: spotLight.angle,
					penumbra: spotLight.penumbra,
					decay: spotLight.decay
				}
				
				gui.add(params, 'light_x').min(-256).max(256).step(1).onChange( function ( val ) {
					spotLight.position.x = val
				});
				gui.add(params, 'light_y').min(-256).max(256).step(1).onChange( function ( val ) {
					spotLight.position.y = val
				});
				gui.add(params, 'light_z').min(-256).max(256).step(1).onChange( function ( val ) {
					spotLight.position.z = val
				});

				gui.addColor( params, 'light color' ).onChange( function ( val ) {

					spotLight.color.setHex( val );
					render();

				} );

				gui.add( params, 'intensity', 0, 2 ).onChange( function ( val ) {

					spotLight.intensity = val;
					render();

				} );


				gui.add( params, 'distance', 50, 200 ).onChange( function ( val ) {

					spotLight.distance = val;
					render();

				} );

				gui.add( params, 'angle', 0, Math.PI / 3 ).onChange( function ( val ) {

					spotLight.angle = val;
					render();

				} );

				gui.add( params, 'penumbra', 0, 1 ).onChange( function ( val ) {

					spotLight.penumbra = val;
					render();

				} );

				gui.add( params, 'decay', 1, 2 ).onChange( function ( val ) {

					spotLight.decay = val;
					render();

				} );

				gui.open();

			}
			
			buildGui();

		</script>