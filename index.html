<!DOCTYPE html>
<html>
	<head>
		<meta charset=utf-8>
		<title>Mike Eagle</title>
		<style>
			body { 
				font-family: 'TerminalGrotesqueRegular'; 
			    font-weight: normal; 
			    font-style: normal; 
				margin: 0; 
			}
			canvas { 
				width: 100%; 
				height: 100%; 
			}
			nav {
				position: absolute;
				top: 0;
				left: 50%;
				width: 150px;
				margin-left: -75px;
				text-align: center;
				z-index: 100;
				display:block;
				color: #000;
				background-color: #fff;
				height: 100vh;
				max-height: 1.5rem;
				overflow: hidden;
				-webkit-transition: 320ms;
				-moz-transition: 320ms;
				-ms-transition: 320ms;
				-o-transition: 320ms;
				transition: 320ms;
				
			}
			nav.open {
				max-height: 1200px;
				-webkit-transition: 320ms;
				-moz-transition: 320ms;
				-ms-transition: 320ms;
				-o-transition: 320ms;
				transition: 320ms;
				
			}
			.menu {
				list-style-type: none;
				padding-left: 0;
				margin-top: 10rem;
			}
			.menu li {
				width: 100%;
				line-height: 2.25em;
			}
			.menu li:hover {
				background-color: #000;
			}
			.menu li a {
				color: #000;
				font-size: 2em;
				text-decoration: none;
				text-transform: uppercase;
				font-weight: 300;
				letter-spacing: 2px;
			}
			.menu li:hover a {
				color: #fff;
			}
			button {
				text-transform: uppercase;
				width: 100%;
				line-height: 1.25rem;
				font-size: 0.8rem;
				background-color: transparent;
				border: 0;
				cursor: pointer;
				font-weight: 600;
			}
			button:focus {
				outline: none;
			}
			#loader {
				background-color: #fff;
				width: 100vw;
				height: 100vh;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			#indicator {
				width: 100%;
				font-size: 3rem;
				text-align: center;
			}
			.loadingbar {
				height: 100vh;
				width: 100vw;
				z-index: -1;
				background-color: #000;
				top: 0;
				left: 0;
				position: absolute;
			}
			#helper_text {
				display: none;
				position: absolute;
				width: 100vw;
				height: 100vh;
				align-items: center;
				justify-content: center;
				pointer-events: none;
			}
			#helper_text span {
				font-size: 18em;
				color: #fff;
				letter-spacing: 2px;
				text-shadow: 10px 10px rgb(0,0,0);
			}
			.display--flex {
				display: flex!important;
			}
		</style>
				<link rel="stylesheet" media="screen" href="https://fontlibrary.org/face/terminal-grotesque" type="text/css"/>
	</head>
	<body>
<!-- 		<nav>
			<button>Open Mike Eagle</button>

			<ul class="menu">
				<li><a href="listen.html">
					Listen
				</a></li>
				<li><a href="watch.html">
					Watch
				</a></li>
				<li><a href="shop.html">
					Shop
				</a></li>
				<li><a href="blog.html">
					Blog
				</a></li>
			</ul>
		</nav> -->
		<!-- <div id="loader">
			<div id="indicator">
				<img src="img/200w_d.gif" alt="Mike Eagle" style="display: block; text-align: center; width: 200px; margin: auto;">
				<span id="percent">0%</span>
			</div>
		</div> -->
		<div id="helper_text">
			<span>SHOP</span>
		</div>

		<script
		  src="https://code.jquery.com/jquery-3.2.0.min.js"
		  integrity="sha256-JAW99MJVpJBGcbzEuXk4Az05s/XyDdBomFqNlM3ic+I="
		  crossorigin="anonymous"></script>
		<script src="js/three.js"></script>
		<script src="js/Tween.js"></script>
		<script src="js/MTLLoader.js"></script>
		<script src="js/OBJLoader.js"></script>
		<script src="js/ColladaLoader.js"></script>
		<script src="js/OrbitControls.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/SkyShader.js"></script>
		<script src="js/dat.gui.min.js"></script>

		<script>
			$('button').on('click', function() {
				console.log('open');
				$('nav').toggleClass('open');
			});
		</script>
		<script>
			(function(){var script=document.createElement('script');script.onload=function(){var stats=new Stats();document.body.appendChild(stats.dom);requestAnimationFrame(function loop(){stats.update();requestAnimationFrame(loop)});};script.src='http://rawgit.com/mrdoob/stats.js/master/build/stats.min.js';document.head.appendChild(script);})()

			var camera, scene, renderer;
			var mtlLoader, objects, ambientLight, controls;
			var floor, floorMat, floorGeo;
			var onProgress, onError;
			var update, render, GameLoop;
			var raycaster, mouse, INTERSECTED;
			var setMaterial;

			var sky, sunSphere;

			var colorHash = {};
			
			var gui;
			
			
			scene = new THREE.Scene();
			scene.fog = new THREE.FogExp2( 0x333333, 0.0009);

			camera = new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight, 0.1, 2000000);

			renderer = new THREE.WebGLRenderer({
				antialias: false
			});
			//renderer.setClearColor(0xFFFFFF);
			renderer.setPixelRatio(window.devicePixelRatio*.75);
			renderer.setSize(window.innerWidth, window.innerHeight);
			renderer.shadowMap.enabled = true;
			// renderer.shadowMap.type = THREE.PCFSoftShadowMap;
			renderer.shadowMap.type = THREE.PCFSoftShadowMap;
			
			
			floorMat = new THREE.MeshBasicMaterial({
				color: 0xFFFFFF,
				side: THREE.DoubleSide
			});
			floorGeo = new THREE.PlaneGeometry(2000,2000,10,10);
			floor = new THREE.Mesh(floorGeo, floorMat);
			floor.position.y = -0.5;
			floor.rotation.x = Math.PI / 2;
			//scene.add(floor);

			ambientLight = new THREE.AmbientLight( 0xFFFFFF, 0.75 );
			
			scene.add( ambientLight)
		
			
			var spotLight = new THREE.SpotLight( '0xfwc97e' );

			spotLight.position.x = 26;
			spotLight.position.y = 256;
			spotLight.position.z = 109;
			spotLight.intensity = 0.7;
			spotLight.distance = 0;
			spotLight.angle = 1;
			spotLight.penumbra = 0.36;
			spotLight.decay = 1;

			spotLight.castShadow = true;

			spotLight.shadow.mapSize.width = 1024;  // default
			spotLight.shadow.mapSize.height = 1024; // default
			spotLight.shadow.camera.near = 0.5;       // default
			spotLight.shadow.camera.far = 500;      // default
			
				
				
			// 				var helper = new THREE.CameraHelper( spotLight.shadow.camera );
			// scene.add( helper );

			scene.add( spotLight );	
						
			var loader = new THREE.ColladaLoader();
			var intersectable = [];

			loader.load(
				// resource URL
				'models/LOWPOLYLAND.dae',
				// Function when resource is loaded
				function ( collada ) {
					dae = collada.scene
					dae.traverse( function(child) {
						child.castShadow = true;
						child.receiveShadow = true;
						if(child.name.indexOf('s_') == 0){
							child.userData = { 
								hovered: false, 
								elevated: false, 
								baseY: child.position.y 
							};
							intersectable.push(child)
						}
						if( child.material ) {
				      	  child.material.side = THREE.DoubleSide;
						}
					});
					scene.add( dae );
				},
				// Function called when download progresses
				function ( xhr ) {
					var p = xhr.loaded / xhr.total * 100;
					document.getElementById("percent").innerHTML = Math.round(p) + '%';
					if (p > 50) {
						
					}
				}
			);

			function initSky() {

				// Add Sky Mesh
				sky = new THREE.Sky();
				scene.add( sky.mesh );

				// Add Sun Helper
				sunSphere = new THREE.Mesh(
					new THREE.SphereBufferGeometry( 20000, 16, 8 ),
					new THREE.MeshBasicMaterial( { color: 0xffffff } )
				);
				sunSphere.position.y = - 700000;
				sunSphere.visible = false;
				scene.add( sunSphere );

				/// GUI

				var effectController  = {
					turbidity: 10.4,
					rayleigh: 1.899,
					mieCoefficient: 0.005,
					mieDirectionalG: 0.323,
					luminance: 0.2,
					inclination: 0.42472, // elevation / inclination
					azimuth: 0.4657, // Facing front,
					sun: ! true
				};

				var distance = 400000;

				function guiChanged() {

					var uniforms = sky.uniforms;
					uniforms.turbidity.value = effectController.turbidity;
					uniforms.rayleigh.value = effectController.rayleigh;
					uniforms.luminance.value = effectController.luminance;
					uniforms.mieCoefficient.value = effectController.mieCoefficient;
					uniforms.mieDirectionalG.value = effectController.mieDirectionalG;

					var theta = Math.PI * ( effectController.inclination - 0.5 );
					var phi = 2 * Math.PI * ( effectController.azimuth - 0.5 );

					sunSphere.position.x = distance * Math.cos( phi );
					sunSphere.position.y = distance * Math.sin( phi ) * Math.sin( theta );
					sunSphere.position.z = distance * Math.sin( phi ) * Math.cos( theta );

					sunSphere.visible = effectController.sun;

					sky.uniforms.sunPosition.value.copy( sunSphere.position );

					renderer.render( scene, camera );

				}

				guiChanged();
			}
			
			//scene.add( ambientLight );

			document.body.appendChild(renderer.domElement);

			window.addEventListener('resize', function() {
				var width = window.innerWidth;
				var height = window.innerHeight;
				renderer.setSize(width, height);
				camera.aspect = width / height;
				camera.updateProjectionMatrix();
			})

			camera.position.z = 120;
			camera.position.x = 0;
			camera.position.y = 20;
			camera.lookAt(new THREE.Vector3())
			controls = new THREE.OrbitControls(camera,renderer.domElement);
			
			
			// new TWEEN.Tween( camera.position ).to( {
			// 						x: 0,
			// 						y: 20,
			// 						z: 120}, 4000 )
			// 					.easing( TWEEN.Easing.Quadratic.Out).start();


						
						
			// new TWEEN.Tween( controls.target ).to( {
			// 				x: 0,
			// 				y: 100,
			// 				z: 0}, 4000 )
			// 				.easing( TWEEN.Easing.Quadratic.Out).start();



			initSky();
			

			raycaster = new THREE.Raycaster();
			mouse = new THREE.Vector2();

			function onMouseMove( event ) {

				// calculate mouse position in normalized device coordinates
				// (-1 to +1) for both components

				mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
				mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
			}
			
			function setMaterial(object, hex) {
				var t = object.material.type.toString();

				if (hex == null) {
				
				colors = colorHash[INTERSECTED.uuid]
				if (t.localeCompare("MultiMaterial") == 0 ) {
						for (i = 0; i < object.material.materials.length; i++) {
							object.material.materials[i].color.setHex(colors[i]);
						}
					}
					else{
						object.material.color.setHex(colors[0]);
					}
				}
				else if (t.localeCompare("MultiMaterial") == 0 ) {
					var materials = object.material.materials
					colorHash[object.uuid] = materials.map(function(obj) { 
					
						return obj.color.getHex()
					});
					object.material.materials = materials.map(function(obj) { 
						var newObj = obj
						newObj.color.setHex(hex)
						return newObj
					});

				}
				else {
					colorHash[object.uuid] = [object.material.color.getHex()];
					object.material.color.setHex(hex)
				}
			}
			
			
			


			update = function() {
			}
			
			
			var bounce = function(obj, point) {
					console.log(obj.name);
						document.getElementById('helper_text').className = "display--flex";
							if ( obj.name === 's_SPOTIFY' ) {
	 							document.getElementById('helper_text').innerHTML = "<span>LISTEN</span>";
	 						} else if ( obj.name === 's_CONTACT' ) {
	 							document.getElementById('helper_text').innerHTML = "<span>CONTACT</span>";
	 						} else if ( obj.name === 's_SOCIAL_MEDIA' ) {
	 							document.getElementById('helper_text').innerHTML = "<span>BLOG</span>";
	 						} else if ( obj.name === 's_YOUTUBE' ) {
	 							document.getElementById('helper_text').innerHTML = "<span>WATCH</span>";
	 						} else if ( obj.name === 's_YOUTUBE_LINK' ) {
	 							document.getElementById('helper_text').innerHTML = '<span><img src="img/wrestling-mask.png"></span>';
	 						} else if ( obj.name === 's_STORE' ) {
	 							document.getElementById('helper_text').innerHTML = "<span>SHOP</span>";
	 						} 
							//obj.parent.userData.hovered = true
							new TWEEN.Tween( obj.position ).to( { y: [point] }, 400 )
							.easing( TWEEN.Easing.Quadratic.Out)
							.onComplete(function() {
								obj.userData.elevated = true
							})
							.start();
						};

			var bounceDown = function(obj) {
						 console.log(obj)
						 	document.getElementById('helper_text').className = "";
							obj.userData.elevated = false
							new TWEEN.Tween( obj.position ).to( { y: [obj.userData.baseY] }, 1000 )
							.easing( TWEEN.Easing.Quadratic.Out)
							.onComplete(function() {
								 
							})
							.start();
						};
			render = function() {
			
			
				TWEEN.update();
				// update the picking ray with the camera and mouse position
				raycaster.setFromCamera( mouse, camera );

				// calculate objects intersecting the picking ray
				var intersects = raycaster.intersectObjects( intersectable, true );
				
				for (i in intersectable) {
					var obj = intersectable[i]
					obj.userData.hovered = false
				}
				
				var y = 0;
				if ( intersects.length > 0 ) {

				// console.log(intersects[0])
					
					if ( INTERSECTED != intersects[ 0 ].object ) {
						//if (INTERSECTED) setMaterial( INTERSECTED, INTERSECTED.currentHex )
						INTERSECTED = intersects[ 0 ].object;
						y = intersects[ 0 ].point.y
 						INTERSECTED.parent.userData.hovered = true;
 						
						
					}
				} else {
					INTERSECTED = null;
					for (i in intersectable) {
				
					var obj = intersectable[i];
					if( obj.userData.elevated == true){
						bounceDown(obj);
					}
					}
				}

				for (i in intersectable) {
					var obj = intersectable[i];
					if (obj.userData.hovered == true) {
						bounce(obj, 600);
					}
					else if (INTERSECTED != null && obj.userData.hovered == false && obj.userData.elevated == true && obj != INTERSECTED.parent) { 
						bounceDown(obj)
					}
				}

				renderer.render(scene, camera);
			}

			GameLoop = function() {
				requestAnimationFrame( GameLoop );
				update();
				render();
			}

			window.addEventListener( 'mousemove', onMouseMove, false );
			GameLoop();
			

		</script>